---
title: 'å¼ºå›½å­¦ä¹ --day2'
date: 2025-11-11
permalink: /posts/2025/11/blog-post-2/
tags:
  - donut
  - math
---

# ğŸ© æ—‹è½¬ç”œç”œåœˆ

ä½ åƒè¿‡ç”œç”œåœˆå—ï¼Ÿå±å¹•æ­£å¸¸éƒ½æ˜¯æ˜¾ç¤ºäºŒç»´å›¾åƒï¼Œä½†æ˜¯é€è¿‡è®¾å®šå…‰çº¿å°„å…¥ä¸åå°„å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„çœ¼ç›æ„Ÿå—åˆ°ä¸‰ç»´ç«‹ä½“çš„æ•ˆæœï¼Œé€šè¿‡æ•°å­¦æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸€æ•ˆæœå®ç°ã€‚

---

## ğŸ§± ä¸€ã€åœ†ç¯çš„å‡ ä½•å»ºæ¨¡ï¼ˆTorus Geometryï¼‰

ç”œç”œåœˆï¼ˆåœ†ç¯é¢ï¼‰æ˜¯ä¸€ä¸ªå°åœ†ç»•ç€ä¸€ä¸ªå¤§åœ†æ—‹è½¬å½¢æˆçš„ä¸‰ç»´æ›²é¢ã€‚

è®¾ï¼š

- å°åœ†åŠå¾„ï¼š\\(R_1\\)ï¼ˆç”œç”œåœˆâ€œç®¡â€çš„åŠå¾„ï¼‰
- å¤§åœ†åŠå¾„ï¼š\\(R_2\\)ï¼ˆç”œç”œåœˆä¸­å¿ƒåˆ°ç®¡å¿ƒçš„è·ç¦»ï¼‰
- å‚æ•°ï¼š
  - $$\theta$$ï¼šå°åœ†è§’åº¦ï¼ˆç®¡çš„æˆªé¢è§’åº¦ï¼‰
  - $$\phi$$ï¼šç»•ä¸­å¿ƒæ—‹è½¬è§’åº¦

åˆ™ä¸‰ç»´å‚æ•°æ–¹ç¨‹ä¸ºï¼š

$$
\begin{aligned}
x &= (R_2 + R_1 \cos \theta)\cos \phi, \\
y &= (R_2 + R_1 \cos \theta)\sin \phi, \\
z &= R_1 \sin \theta.
\end{aligned}
$$

è¿™äº›ç‚¹ \\((x,y,z\\)) æ„æˆäº†ä¸€ä¸ªä½äºåŸç‚¹çš„åœ†ç¯ã€‚

---

## ğŸ§­ äºŒã€ç©ºé—´æ—‹è½¬ (3D Rotation)

ä¸ºäº†è®©ç”œç”œåœˆâ€œåŸåœ°æ—‹è½¬â€ï¼Œæˆ‘ä»¬éœ€è¦ç»•å¤šä¸ªåæ ‡è½´è¿›è¡Œæ—‹è½¬å˜æ¢ã€‚

### æ—‹è½¬çŸ©é˜µï¼š

- ç»• **X è½´**ï¼ˆå‰åç¿»æ»šï¼‰ï¼š
  $$
  R_x(A) =
  \begin{bmatrix}
  1 & 0 & 0 \\
  0 & \cos A & -\sin A \\
  0 & \sin A & \cos A
  \end{bmatrix}
  $$

- ç»• **Y è½´**ï¼ˆå·¦å³ç¿»æ»šï¼‰ï¼š
  $$
  R_y(C) =
  \begin{bmatrix}
  \cos C & 0 & \sin C \\
  0 & 1 & 0 \\
  -\sin C & 0 & \cos C
  \end{bmatrix}
  $$

- ç»• **Z è½´**ï¼ˆè‡ªè½¬ï¼‰ï¼š
  $$
  R_z(B) =
  \begin{bmatrix}
  \cos B & -\sin B & 0 \\
  \sin B & \cos B & 0 \\
  0 & 0 & 1
  \end{bmatrix}
  $$

### ç»¼åˆæ—‹è½¬ï¼š

æŒ‰é¡ºåºå°†ä¸‰æ¬¡æ—‹è½¬ä½œç”¨äºåœ†ç¯ç‚¹ï¼š

$$
\mathbf{r'} = R_z(B) \, R_y(C) \, R_x(A) \, \mathbf{r}
$$

è¿™æ ·ç”œç”œåœˆå°±èƒ½åœ¨è‡ªèº«ä¸­å¿ƒè¿›è¡Œâ€œå‰å + å·¦å³ + è‡ªè½¬â€çš„å¤åˆæ—‹è½¬ã€‚

---

## ğŸ¥ ä¸‰ã€é€è§†æŠ•å½±ï¼ˆPerspective Projectionï¼‰

ä¸ºäº†æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œéœ€è¦å°†ä¸‰ç»´åæ ‡ \\((x', y', z'\\)) æŠ•å½±åˆ°äºŒç»´å¹³é¢ä¸Šã€‚

ä½¿ç”¨ç®€å•çš„é€è§†æŠ•å½±æ¨¡å‹ï¼š

$$
\begin{aligned}
x_p &= \frac{K_1 x'}{K_2 + z'}, \\
y_p &= \frac{K_1 y'}{K_2 + z'}.
\end{aligned}
$$

å…¶ä¸­ï¼š

- \\(K_1\\) æ§åˆ¶ç¼©æ”¾ï¼›
- \\(K_2\\) æ§åˆ¶è§†è·ï¼›
- å½“ \\(z'\\) å¢å¤§æ—¶ï¼Œç‰©ä½“çœ‹èµ·æ¥æ›´å°ï¼Œå½¢æˆé€è§†ã€‚

---

## ğŸ§  å››ã€å…‰ç…§æ¨¡å‹ï¼ˆLighting Modelï¼‰

è¯¥ç‰ˆæœ¬ä½¿ç”¨äº†ä¸€ä¸ªå›ºå®šæ–¹å‘çš„å¹³è¡Œå…‰æºï¼ˆä¾‹å¦‚æ¥è‡ª â€œå³ä¸Šå‰æ–¹â€ï¼‰ï¼Œé‡‡ç”¨**æœ—ä¼¯æ¼«åå°„æ¨¡å‹ (Lambertian Reflection)**ï¼š

### 1ï¸âƒ£ æ³•å‘é‡ï¼ˆNormal Vectorï¼‰

åœ¨â€œå±€éƒ¨åæ ‡ç³»â€ä¸­ï¼Œåœ†ç¯è¡¨é¢çš„æ³•å‘é‡ä¸ºï¼š

$$
\mathbf{N} =
\begin{bmatrix}
\cos \phi \cos \theta \\
\sin \phi \cos \theta \\
\sin \theta
\end{bmatrix}
$$

å®ƒæŒ‡å‘è¡¨é¢å¤–ä¾§çš„æ³•çº¿æ–¹å‘ã€‚

åŒæ ·éœ€è¦ç»è¿‡ä¸ç‚¹ç›¸åŒçš„æ—‹è½¬ï¼š

$$
\mathbf{N'} = R_z(B) \, R_y(C) \, R_x(A) \, \mathbf{N}
$$

---

### 2ï¸âƒ£ å…‰æºæ–¹å‘ï¼ˆLight Directionï¼‰

è®¾å…‰æºæ–¹å‘ä¸ºï¼ˆå•ä½å‘é‡ï¼‰ï¼š

$$
\mathbf{L_s} = \frac{1}{\sqrt{3}}
\begin{bmatrix}
1 \\ 1 \\ -1
\end{bmatrix}
$$

å³ä»å³ä¸Šå‰æ–¹ç…§å°„ã€‚

---

### 3ï¸âƒ£ äº®åº¦è®¡ç®—ï¼ˆLambert å…‰ç…§ï¼‰

è¡¨é¢äº®åº¦ä¸ºæ³•å‘é‡ä¸å…‰æºæ–¹å‘çš„ç‚¹ç§¯ï¼š

$$
L = \max(0, \mathbf{N'} \cdot \mathbf{L_s})
$$

å– $$\max(0, L)$$æ˜¯ä¸ºäº†å¿½ç•¥èƒŒé¢ï¼ˆå…‰ç…§ä¸åˆ°çš„éƒ¨åˆ†ï¼‰ã€‚

---

## ğŸ’¡ äº”ã€å­—ç¬¦äº®åº¦æ˜ å°„ï¼ˆASCII Brightness Mappingï¼‰

ä½¿ç”¨ä¸€ç»„ä»â€œæš—â€åˆ°â€œäº®â€çš„å­—ç¬¦è¿›è¡Œäº®åº¦ç¼–ç ï¼š
```js
.,-~:;=!*#$@
```

æ˜ å°„è§„åˆ™ï¼š

$$
\text{char\_index} = \lfloor L \times (N_{\text{chars}} - 1) \rfloor
$$

äº®åº¦è¶Šé«˜çš„ç‚¹é€‰ç”¨æ›´â€œå®â€çš„å­—ç¬¦ï¼Œå½¢æˆè§†è§‰ä¸Šçš„æ˜æš—å±‚æ¬¡ã€‚

---

## ğŸ§® å…­ã€æ·±åº¦æ’åºï¼ˆZ-bufferï¼‰

ä¸ºä¿è¯è¿‘å¤„å­—ç¬¦é®æŒ¡è¿œå¤„å­—ç¬¦ï¼Œå¼•å…¥æ·±åº¦ç¼“å†²ï¼š

- å¯¹æ¯ä¸ªåƒç´ ä½ç½® `(x_p, y_p)`ï¼Œè®°å½•ä¸€ä¸ªâ€œé€†æ·±åº¦â€ï¼š
  $$
  \text{ooz} = \frac{1}{K_2 + z'}
  $$
- è‹¥å½“å‰ç‚¹çš„ `ooz` å¤§äºä¹‹å‰çš„å€¼ï¼Œåˆ™æ›´æ–°è¯¥åƒç´ ã€‚

è¿™æ ·èƒ½æ­£ç¡®å¤„ç†â€œå‰é¢æŒ¡ä½åé¢â€çš„è§†è§‰æ•ˆæœã€‚

---

## ğŸŒ€ ä¸ƒã€åŠ¨ç”»å®ç°

åœ¨æ¯ä¸€å¸§ä¸­ï¼Œè§’åº¦ä¸æ–­å˜åŒ–ï¼š

$$
\begin{aligned}
A &\leftarrow A + \Delta A, \\
B &\leftarrow B + \Delta B, \\
C &\leftarrow C + \Delta C,
\end{aligned}
$$

æ¯ 22msï¼ˆçº¦ 20 å¸§/ç§’ï¼‰é‡æ–°è®¡ç®—åœ†ç¯ç‚¹ã€äº®åº¦ä¸å­—ç¬¦çŸ©é˜µï¼Œå½¢æˆè¿ç»­æ—‹è½¬ã€‚

---

## ğŸ§© å…«ã€å®Œæ•´æµç¨‹æ¦‚è§ˆ

1. å»ºç«‹å‚æ•°åŒ–åœ†ç¯ï¼›
2. å¯¹æ¯ä¸ªç‚¹è®¡ç®—æ³•çº¿ï¼›
3. å°†ç‚¹ä¸æ³•çº¿ä¸€èµ·æ—‹è½¬ï¼ˆXã€Yã€Z ä¸‰è½´ï¼‰ï¼›
4. æŠ•å½±åˆ° 2Dï¼›
5. è®¡ç®—äº®åº¦ï¼›
6. ç”¨å­—ç¬¦æ˜ å°„äº®åº¦ï¼›
7. ç”¨ z-buffer ç¡®ä¿é®æŒ¡ï¼›
8. æ¯å¸§æ›´æ–°è§’åº¦ã€‚

---

## ğŸ§¬ å…³é”®æ•°å­¦æ€»ç»“

$$
\begin{aligned}
\mathbf{r} &= 
\begin{bmatrix}
(R_2 + R_1 \cos \theta)\cos \phi \\
(R_2 + R_1 \cos \theta)\sin \phi \\
R_1 \sin \theta
\end{bmatrix}, \\[6pt]
\mathbf{N} &= 
\begin{bmatrix}
\cos \phi \cos \theta \\
\sin \phi \cos \theta \\
\sin \theta
\end{bmatrix}, \\[6pt]
\mathbf{r'} &= R_z(B) R_y(C) R_x(A) \mathbf{r}, \\[6pt]
\mathbf{N'} &= R_z(B) R_y(C) R_x(A) \mathbf{N}, \\[6pt]
(x_p, y_p) &= \left(\frac{K_1 x'}{K_2 + z'}, \frac{K_1 y'}{K_2 + z'}\right), \\[6pt]
L &= \max(0, \mathbf{N'} \cdot \mathbf{L_s}).
\end{aligned}
$$

---

## ğŸ”š ä¹ã€æ•ˆæœæ˜¾ç¤º
![](https://mrwhy233.github.io/tryhard.github.io//images/donut.gif)

---

## ä»£ç 
```html
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æ—‹è½¬ç”œç”œåœˆ</title>
  <style>
    body {
      background: black;
      color: white;
      font-family: monospace;
      white-space: pre;
      font-size: 10px;
      line-height: 8px;
      text-align: center;
      overflow: hidden;
    }
    pre {
      display: inline-block;
      text-align: left;
    }
  </style>
</head>
<body>
  <pre id="donut"></pre>

  <script>
    const pre = document.getElementById('donut');
    const width = 80, height = 40;
    let A = 0, B = 0, C = 0;

    function renderFrame() {
      const output = [];
      const zbuffer = [];
      for (let i = 0; i < width * height; i++) {
        output[i] = ' ';
        zbuffer[i] = 0;
      }

      const R1 = 1, R2 = 2, K2 = 6, K1 = 40;

      const cosA = Math.cos(A), sinA = Math.sin(A);
      const cosB = Math.cos(B), sinB = Math.sin(B);
      const cosC = Math.cos(C), sinC = Math.sin(C);

      const Lx = 1 / Math.sqrt(3);
      const Ly = 1 / Math.sqrt(3);
      const Lz = -1 / Math.sqrt(3);

      for (let theta = 0; theta < 2 * Math.PI; theta += 0.07) {
        for (let phi = 0; phi < 2 * Math.PI; phi += 0.02) {
          const cosTheta = Math.cos(theta), sinTheta = Math.sin(theta);
          const cosPhi = Math.cos(phi), sinPhi = Math.sin(phi);

          const circleX = R2 + R1 * cosTheta;
          const x = circleX * cosPhi;
          const y = circleX * sinPhi;
          const z = R1 * sinTheta;

          // ç»• X
          let y1 = y * cosA - z * sinA;
          let z1 = y * sinA + z * cosA;
          let x1 = x;

          // ç»• Y
          let z2 = z1 * cosC - x1 * sinC;
          let x2 = z1 * sinC + x1 * cosC;
          let y2 = y1;

          // ç»• Z
          let x3 = x2 * cosB - y2 * sinB;
          let y3 = x2 * sinB + y2 * cosB;
          let z3 = z2;

          // --- æŠ•å½± ---
          const ooz = 1 / (K2 + z3);
          const xp = Math.floor(width / 2 + K1 * ooz * x3);
          const yp = Math.floor(height / 2 - K1 * 0.5 * ooz * y3);

          // --- æ³•å‘é‡æ—‹è½¬ (ä¸å‡ ä½•ç›¸åŒçš„æ—‹è½¬è¿‡ç¨‹) ---
          let Nx = cosPhi * cosTheta;
          let Ny = sinPhi * cosTheta;
          let Nz = sinTheta;

          // åŒæ ·çš„æ—‹è½¬åº”ç”¨åˆ°æ³•å‘é‡
          let Ny1 = Ny * cosA - Nz * sinA;
          let Nz1 = Ny * sinA + Nz * cosA;
          let Nx1 = Nx;

          let Nz2 = Nz1 * cosC - Nx1 * sinC;
          let Nx2 = Nz1 * sinC + Nx1 * cosC;
          let Ny2 = Ny1;

          let Nx3 = Nx2 * cosB - Ny2 * sinB;
          let Ny3 = Nx2 * sinB + Ny2 * cosB;
          let Nz3 = Nz2;

          // --- å…‰ç…§è®¡ç®— ---
          let L = Nx3 * Lx + Ny3 * Ly + Nz3 * Lz;
          if (L < 0) L = 0; // åªæ˜¾ç¤ºæ­£é¢
          const luminance_chars = ".,-~:;=!*#$@";
          const luminance_index = Math.floor(L * (luminance_chars.length - 1));

          const idx = xp + yp * width;
          if (yp >= 0 && yp < height && xp >= 0 && xp < width && ooz > zbuffer[idx]) {
            zbuffer[idx] = ooz;
            output[idx] = luminance_chars[luminance_index];
          }
        }
      }

      let frame = '';
      for (let i = 0; i < output.length; i++) {
        frame += i % width ? output[i] : '\n';
      }

      pre.textContent = frame;

      A += 0.04;
      B += 0.05;
      C += 0.03;
    }

    setInterval(renderFrame, 22);
  </script>
</body>
</html>
```